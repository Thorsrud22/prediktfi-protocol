#!/bin/bash

# Smoke Test: Trading Flow
# Tests the complete Studio â†’ Actions â†’ Intent creation flow

echo "ðŸ§ª Smoke Test: Trading Flow"
echo "================================"
echo ""

echo "ðŸ“‹ Manual Test Checklist:"
echo ""

echo "1ï¸âƒ£  Studio Analysis & Draft Creation"
echo "   â–¡ Navigate to /studio"
echo "   â–¡ Enter a prediction (e.g., 'Will Bitcoin reach \$100k by end of 2024?')"
echo "   â–¡ Select topic: 'Crypto', horizon: '30 days'"
echo "   â–¡ Click 'Generate Insight' and wait for analysis"
echo "   â–¡ Verify analysis shows probability % and confidence %"
echo "   â–¡ Click 'Save & Preview' button"
echo ""

echo "2ï¸âƒ£  Save Modal & Trade Button"
echo "   â–¡ Save modal opens with insight summary"
echo "   â–¡ Verify 'Save & Stamp' shows disabled state with Pro hint tooltip"
echo "   â–¡ Click 'ðŸš€ Trade This Prediction' button"
echo "   â–¡ Check console for '[Trade] Draft created:' log entry"
echo "   â–¡ Verify navigation to /advisor/actions?draft=1"
echo ""

echo "3ï¸âƒ£  Actions Page & Composer"
echo "   â–¡ Trading Intent Composer appears at top"
echo "   â–¡ Verify all fields prefilled from analysis:"
echo "     - Asset symbol (BTC/ETH/SOL/etc.)"
echo "     - Direction (Long if prob >= 50%, Short if < 50%)"
echo "     - Confidence slider matches analysis"
echo "     - Probability readonly field matches analysis"
echo "     - Thesis textarea has content from rationale"
echo "     - Time horizon defaults to 30 days"
echo ""

echo "4ï¸âƒ£  Intent Creation"
echo "   â–¡ Modify any fields if desired (optional)"
echo "   â–¡ Click 'Create Intent (Dev)' button"
echo "   â–¡ Check console for '[Actions] Intent created:' log entry"
echo "   â–¡ Verify toast notification appears: 'Intent created successfully!'"
echo "   â–¡ Composer disappears"
echo "   â–¡ Intent appears in 'Your Intents' section below"
echo ""

echo "5ï¸âƒ£  Persistence Tests"
echo "   â–¡ Refresh the /advisor/actions page"
echo "   â–¡ Verify intent still appears in 'Your Intents' section"
echo "   â–¡ Navigate to /studio, then back to /advisor/actions"
echo "   â–¡ Verify intent persists across navigation"
echo "   â–¡ Check localStorage in DevTools for 'predikt:user-intents' key"
echo ""

echo "6ï¸âƒ£  Wallet Session Persistence"
echo "   â–¡ Connect wallet in header: 'Connect Phantom' button"
echo "   â–¡ Complete wallet connection and sign-in"
echo "   â–¡ Navigate between /studio and /advisor/actions multiple times"
echo "   â–¡ Verify wallet address stays visible in header (e.g., 'Ez6d...md5')"
echo "   â–¡ Confirm no repeated sign prompts during navigation"
echo "   â–¡ Check console for minimal wallet error spam"
echo ""

echo "7ï¸âƒ£  Empty State Test"
echo "   â–¡ Clear localStorage: 'predikt:user-intents'"
echo "   â–¡ Navigate to /advisor/actions (without ?draft=1)"
echo "   â–¡ Verify empty state appears with English text:"
echo "     'Send a prediction from Studio to start trading'"
echo "   â–¡ Click 'Open Studio' button"
echo "   â–¡ Verify navigation to /studio"
echo ""

echo "âœ… Expected Console Logs:"
echo "   [Trade] Draft created: { id, asset, direction, probability, confidence }"
echo "   [Actions] Intent created: { id, asset, direction, probability, confidence, horizonDays, totalIntents }"
echo ""

echo "âŒ Console Should NOT Show:"
echo "   - Repeated wallet connection errors"
echo "   - JSON parse errors"
echo "   - Multiple sign-in prompts"
echo "   - Wallet adapter spam"
echo ""

echo "ðŸŽ¯ Success Criteria:"
echo "   â–¡ Complete flow works without errors"
echo "   â–¡ Draft and intent data persists across refreshes"
echo "   â–¡ Wallet session maintained during navigation"
echo "   â–¡ Clean console logs (only meaningful messages)"
echo "   â–¡ UI shows appropriate states and feedback"
echo ""

echo "ðŸ“ Notes:"
echo "   - Test in development environment"
echo "   - Use Chrome DevTools to monitor console and localStorage"
echo "   - Test with Phantom wallet installed"
echo "   - Verify responsive design on different screen sizes"
echo ""

echo "ðŸš€ Ready to test! Open http://localhost:3000/studio to begin."
